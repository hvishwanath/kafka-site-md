<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>KRaft | </title><meta name=description content="KRaft"><meta property="og:title" content="KRaft"><meta property="og:description" content="KRaft"><meta property="og:type" content="article"><meta property="og:url" content="https://example.kafka-site-md.dev/39/operations/kraft/"><meta property="article:section" content="39"><meta property="article:modified_time" content="2025-07-06T12:09:43-07:00"><meta itemprop=name content="KRaft"><meta itemprop=description content="KRaft"><meta itemprop=dateModified content="2025-07-06T12:09:43-07:00"><meta itemprop=wordCount content="3446"><meta itemprop=keywords content="kafka,docs,"><meta name=twitter:card content="summary"><meta name=twitter:title content="KRaft"><meta name=twitter:description content="KRaft"><link rel=preload href=/scss/main.min.7ed0eb3fc68a0678ca492e0db9c00f8e8d5b776bbb2fb833732191f6bbf02877.css as=style integrity="sha256-ftDrP8aKBnjKSS4NucAPjo1bd2u7L7gzcyGR9rvwKHc=" crossorigin=anonymous><link href=/scss/main.min.7ed0eb3fc68a0678ca492e0db9c00f8e8d5b776bbb2fb833732191f6bbf02877.css rel=stylesheet integrity="sha256-ftDrP8aKBnjKSS4NucAPjo1bd2u7L7gzcyGR9rvwKHc=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg width="154" height="250" viewBox="0 0 256 416" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid"><path d="M201.816 230.216c-16.186.0-30.697 7.171-40.634 18.461l-25.463-18.026c2.703-7.442 4.255-15.433 4.255-23.797.0-8.219-1.498-16.076-4.112-23.408l25.406-17.835c9.936 11.233 24.409 18.365 40.548 18.365 29.875.0 54.184-24.305 54.184-54.184.0-29.879-24.309-54.184-54.184-54.184s-54.184 24.305-54.184 54.184c0 5.348.808 10.505 2.258 15.389l-25.423 17.844c-10.62-13.175-25.911-22.374-43.333-25.182v-30.64c24.544-5.155 43.037-26.962 43.037-53.019C124.171 24.305 99.862.0 69.987.0 40.112.0 15.803 24.305 15.803 54.184c0 25.708 18.014 47.246 42.067 52.769v31.038C25.044 143.753.0 172.401.0 206.854c0 34.621 25.292 63.374 58.355 68.94v32.774c-24.299 5.341-42.552 27.011-42.552 52.894.0 29.879 24.309 54.184 54.184 54.184s54.184-24.305 54.184-54.184c0-25.883-18.253-47.553-42.552-52.894v-32.775a69.965 69.965.0 0042.6-24.776l25.633 18.143c-1.423 4.84-2.22 9.946-2.22 15.24.0 29.879 24.309 54.184 54.184 54.184S256 314.279 256 284.4c0-29.879-24.309-54.184-54.184-54.184zm0-126.695c14.487.0 26.27 11.788 26.27 26.271s-11.783 26.27-26.27 26.27-26.27-11.787-26.27-26.27 11.783-26.271 26.27-26.271zm-158.1-49.337c0-14.483 11.784-26.27 26.271-26.27s26.27 11.787 26.27 26.27c0 14.483-11.783 26.27-26.27 26.27s-26.271-11.787-26.271-26.27zm52.541 307.278c0 14.483-11.783 26.27-26.27 26.27s-26.271-11.787-26.271-26.27 11.784-26.27 26.271-26.27 26.27 11.787 26.27 26.27zm-26.272-117.97c-20.205.0-36.642-16.434-36.642-36.638.0-20.205 16.437-36.642 36.642-36.642 20.204.0 36.641 16.437 36.641 36.642.0 20.204-16.437 36.638-36.641 36.638zm131.831 67.179c-14.487.0-26.27-11.788-26.27-26.271s11.783-26.27 26.27-26.27 26.27 11.787 26.27 26.27-11.783 26.271-26.27 26.271z" style="fill:#231f20"/></svg></span><span class=navbar-brand__name></span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/40/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/blog/><span>Blog</span></a></li><li class=nav-item><a class=nav-link href=/community/><span>Community</span></a></li><li class=nav-item><a class=nav-link href=/testimonials/><span>Testimonials</span></a></li><li class=nav-item><a class=nav-link href=/community/downloads/><span>Download Kafka</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Releases</a><ul class=dropdown-menu><li><a class=dropdown-item href=/40/>4.0</a></li><li><a class=dropdown-item href=/39/>3.9</a></li><li><a class=dropdown-item href=/38/>3.8</a></li><li><a class=dropdown-item href=/37/>3.7</a></li><li><a class=dropdown-item href=/36/>3.6</a></li><li><a class=dropdown-item href=/35/>3.5</a></li><li><a class=dropdown-item href=/34/>3.4</a></li><li><a class=dropdown-item href=/33/>3.3</a></li><li><a class=dropdown-item href=/32/>3.2</a></li><li><a class=dropdown-item href=/31/>3.1</a></li><li><a class=dropdown-item href=/30/>3.0</a></li><li><a class=dropdown-item href=/28/>2.8</a></li><li><a class=dropdown-item href=/27/>2.7</a></li><li><a class=dropdown-item href=/26/>2.6</a></li><li><a class=dropdown-item href=/25/>2.5</a></li><li><a class=dropdown-item href=/24/>2.4</a></li><li><a class=dropdown-item href=/23/>2.3</a></li><li><a class=dropdown-item href=/22/>2.2</a></li><li><a class=dropdown-item href=/21/>2.1</a></li><li><a class=dropdown-item href=/20/>2.0</a></li><li><a class=dropdown-item href=/11/>1.1</a></li><li><a class=dropdown-item href=/10/>1.0</a></li><li><a class=dropdown-item href=/0110/>0.11.0</a></li><li><a class=dropdown-item href=/0102/>0.10.2</a></li><li><a class=dropdown-item href=/0101/>0.10.1</a></li><li><a class=dropdown-item href=/0100/>0.10.0</a></li><li><a class=dropdown-item href=/090/>0.9.0</a></li><li><a class=dropdown-item href=/082/>0.8.2</a></li><li><a class=dropdown-item href=/081/>0.8.1</a></li><li><a class=dropdown-item href=/080/>0.8.0</a></li><li><a class=dropdown-item href=/07/>0.7</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.b12dd2b63080ea49c35456712ace836e.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.b12dd2b63080ea49c35456712ace836e.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="td-sidebar-nav collapse td-sidebar-nav--search-disabled foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-39-li><a href=/39/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-39><span>AK 3.9.X</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-39getting-started-li><input type=checkbox id=m-39getting-started-check>
<label for=m-39getting-started-check><a href=/39/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-39getting-started><span>Getting Started</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39getting-startedintroduction-li><input type=checkbox id=m-39getting-startedintroduction-check>
<label for=m-39getting-startedintroduction-check><a href=/39/getting-started/introduction/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39getting-startedintroduction><span>Introduction</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39getting-starteduses-li><input type=checkbox id=m-39getting-starteduses-check>
<label for=m-39getting-starteduses-check><a href=/39/getting-started/uses/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39getting-starteduses><span>Use Cases</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39getting-startedquickstart-li><input type=checkbox id=m-39getting-startedquickstart-check>
<label for=m-39getting-startedquickstart-check><a href=/39/getting-started/quickstart/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39getting-startedquickstart><span>Quick Start</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39getting-startedecosystem-li><input type=checkbox id=m-39getting-startedecosystem-check>
<label for=m-39getting-startedecosystem-check><a href=/39/getting-started/ecosystem/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39getting-startedecosystem><span>Ecosystem</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39getting-startedupgrade-li><input type=checkbox id=m-39getting-startedupgrade-check>
<label for=m-39getting-startedupgrade-check><a href=/39/getting-started/upgrade/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39getting-startedupgrade><span>Upgrading</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39getting-starteddocker-li><input type=checkbox id=m-39getting-starteddocker-check>
<label for=m-39getting-starteddocker-check><a href=/39/getting-started/docker/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39getting-starteddocker><span>Docker</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-39apis-li><input type=checkbox id=m-39apis-check>
<label for=m-39apis-check><a href=/39/apis/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-39apis><span>APIs</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39apisapi-li><input type=checkbox id=m-39apisapi-check>
<label for=m-39apisapi-check><a href=/39/apis/api/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39apisapi><span>API</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-39configuration-li><input type=checkbox id=m-39configuration-check>
<label for=m-39configuration-check><a href=/39/configuration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-39configuration><span>Configuration</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39configurationconfiguration-li><input type=checkbox id=m-39configurationconfiguration-check>
<label for=m-39configurationconfiguration-check><a href=/39/configuration/configuration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39configurationconfiguration><span>Configuration</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-39design-li><input type=checkbox id=m-39design-check>
<label for=m-39design-check><a href=/39/design/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-39design><span>Design</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39designdesign-li><input type=checkbox id=m-39designdesign-check>
<label for=m-39designdesign-check><a href=/39/design/design/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39designdesign><span>Design</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39designprotocol-li><input type=checkbox id=m-39designprotocol-check>
<label for=m-39designprotocol-check><a href=/39/design/protocol/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39designprotocol><span>Protocol</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-39implementation-li><input type=checkbox id=m-39implementation-check>
<label for=m-39implementation-check><a href=/39/implementation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-39implementation><span>Implementation</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39implementationnetwork-layer-li><input type=checkbox id=m-39implementationnetwork-layer-check>
<label for=m-39implementationnetwork-layer-check><a href=/39/implementation/network-layer/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39implementationnetwork-layer><span>Network Layer</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39implementationmessages-li><input type=checkbox id=m-39implementationmessages-check>
<label for=m-39implementationmessages-check><a href=/39/implementation/messages/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39implementationmessages><span>Messages</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39implementationmessage-format-li><input type=checkbox id=m-39implementationmessage-format-check>
<label for=m-39implementationmessage-format-check><a href=/39/implementation/message-format/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39implementationmessage-format><span>Message Format</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39implementationlog-li><input type=checkbox id=m-39implementationlog-check>
<label for=m-39implementationlog-check><a href=/39/implementation/log/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39implementationlog><span>Log</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39implementationdistribution-li><input type=checkbox id=m-39implementationdistribution-check>
<label for=m-39implementationdistribution-check><a href=/39/implementation/distribution/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39implementationdistribution><span>Distribution</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-39operations-li><input type=checkbox id=m-39operations-check checked>
<label for=m-39operations-check><a href=/39/operations/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-39operations><span>Operations</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39operationsbasic-kafka-operations-li><input type=checkbox id=m-39operationsbasic-kafka-operations-check>
<label for=m-39operationsbasic-kafka-operations-check><a href=/39/operations/basic-kafka-operations/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39operationsbasic-kafka-operations><span>Basic Kafka Operations</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39operationsdatacenters-li><input type=checkbox id=m-39operationsdatacenters-check>
<label for=m-39operationsdatacenters-check><a href=/39/operations/datacenters/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39operationsdatacenters><span>Datacenters</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39operationsgeo-replication-cross-cluster-data-mirroring-li><input type=checkbox id=m-39operationsgeo-replication-cross-cluster-data-mirroring-check>
<label for=m-39operationsgeo-replication-cross-cluster-data-mirroring-check><a href=/39/operations/geo-replication-cross-cluster-data-mirroring/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39operationsgeo-replication-cross-cluster-data-mirroring><span>Geo-Replication (Cross-Cluster Data Mirroring)</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39operationsmulti-tenancy-li><input type=checkbox id=m-39operationsmulti-tenancy-check>
<label for=m-39operationsmulti-tenancy-check><a href=/39/operations/multi-tenancy/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39operationsmulti-tenancy><span>Multi-Tenancy</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39operationskafka-configuration-li><input type=checkbox id=m-39operationskafka-configuration-check>
<label for=m-39operationskafka-configuration-check><a href=/39/operations/kafka-configuration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39operationskafka-configuration><span>Kafka Configuration</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39operationsjava-version-li><input type=checkbox id=m-39operationsjava-version-check>
<label for=m-39operationsjava-version-check><a href=/39/operations/java-version/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39operationsjava-version><span>Java Version</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39operationshardware-and-os-li><input type=checkbox id=m-39operationshardware-and-os-check>
<label for=m-39operationshardware-and-os-check><a href=/39/operations/hardware-and-os/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39operationshardware-and-os><span>Hardware and OS</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39operationsmonitoring-li><input type=checkbox id=m-39operationsmonitoring-check>
<label for=m-39operationsmonitoring-check><a href=/39/operations/monitoring/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39operationsmonitoring><span>Monitoring</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39operationszookeeper-li><input type=checkbox id=m-39operationszookeeper-check>
<label for=m-39operationszookeeper-check><a href=/39/operations/zookeeper/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39operationszookeeper><span>ZooKeeper</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-39operationskraft-li><input type=checkbox id=m-39operationskraft-check checked>
<label for=m-39operationskraft-check><a href=/39/operations/kraft/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-39operationskraft><span class=td-sidebar-nav-active-item>KRaft</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39operationstiered-storage-li><input type=checkbox id=m-39operationstiered-storage-check>
<label for=m-39operationstiered-storage-check><a href=/39/operations/tiered-storage/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39operationstiered-storage><span>Tiered Storage</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-39security-li><input type=checkbox id=m-39security-check>
<label for=m-39security-check><a href=/39/security/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-39security><span>Security</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39securitysecurity-overview-li><input type=checkbox id=m-39securitysecurity-overview-check>
<label for=m-39securitysecurity-overview-check><a href=/39/security/security-overview/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39securitysecurity-overview><span>Security Overview</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39securitylistener-configuration-li><input type=checkbox id=m-39securitylistener-configuration-check>
<label for=m-39securitylistener-configuration-check><a href=/39/security/listener-configuration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39securitylistener-configuration><span>Listener Configuration</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39securityencryption-and-authentication-using-ssl-li><input type=checkbox id=m-39securityencryption-and-authentication-using-ssl-check>
<label for=m-39securityencryption-and-authentication-using-ssl-check><a href=/39/security/encryption-and-authentication-using-ssl/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39securityencryption-and-authentication-using-ssl><span>Encryption and Authentication using SSL</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39securityauthentication-using-sasl-li><input type=checkbox id=m-39securityauthentication-using-sasl-check>
<label for=m-39securityauthentication-using-sasl-check><a href=/39/security/authentication-using-sasl/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39securityauthentication-using-sasl><span>Authentication using SASL</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39securityauthorization-and-acls-li><input type=checkbox id=m-39securityauthorization-and-acls-check>
<label for=m-39securityauthorization-and-acls-check><a href=/39/security/authorization-and-acls/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39securityauthorization-and-acls><span>Authorization and ACLs</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39securityincorporating-security-features-in-a-running-cluster-li><input type=checkbox id=m-39securityincorporating-security-features-in-a-running-cluster-check>
<label for=m-39securityincorporating-security-features-in-a-running-cluster-check><a href=/39/security/incorporating-security-features-in-a-running-cluster/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39securityincorporating-security-features-in-a-running-cluster><span>Incorporating Security Features in a Running Cluster</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39securityzookeeper-authentication-li><input type=checkbox id=m-39securityzookeeper-authentication-check>
<label for=m-39securityzookeeper-authentication-check><a href=/39/security/zookeeper-authentication/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39securityzookeeper-authentication><span>ZooKeeper Authentication</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39securityzookeeper-encryption-li><input type=checkbox id=m-39securityzookeeper-encryption-check>
<label for=m-39securityzookeeper-encryption-check><a href=/39/security/zookeeper-encryption/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39securityzookeeper-encryption><span>ZooKeeper Encryption</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-39kafka-connect-li><input type=checkbox id=m-39kafka-connect-check>
<label for=m-39kafka-connect-check><a href=/39/kafka-connect/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-39kafka-connect><span>Kafka Connect</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39kafka-connectoverview-li><input type=checkbox id=m-39kafka-connectoverview-check>
<label for=m-39kafka-connectoverview-check><a href=/39/kafka-connect/overview/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39kafka-connectoverview><span>Overview</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39kafka-connectuser-guide-li><input type=checkbox id=m-39kafka-connectuser-guide-check>
<label for=m-39kafka-connectuser-guide-check><a href=/39/kafka-connect/user-guide/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39kafka-connectuser-guide><span>User Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39kafka-connectconnector-development-guide-li><input type=checkbox id=m-39kafka-connectconnector-development-guide-check>
<label for=m-39kafka-connectconnector-development-guide-check><a href=/39/kafka-connect/connector-development-guide/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39kafka-connectconnector-development-guide><span>Connector Development Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39kafka-connectadministration-li><input type=checkbox id=m-39kafka-connectadministration-check>
<label for=m-39kafka-connectadministration-check><a href=/39/kafka-connect/administration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39kafka-connectadministration><span>Administration</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-39streams-li><input type=checkbox id=m-39streams-check>
<label for=m-39streams-check><a href=/39/streams/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-39streams><span>Kafka Streams</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsintroduction-li><input type=checkbox id=m-39streamsintroduction-check>
<label for=m-39streamsintroduction-check><a href=/39/streams/introduction/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsintroduction><span>Introduction</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsquickstart-li><input type=checkbox id=m-39streamsquickstart-check>
<label for=m-39streamsquickstart-check><a href=/39/streams/quickstart/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsquickstart><span>Quick Start</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamstutorial-li><input type=checkbox id=m-39streamstutorial-check>
<label for=m-39streamstutorial-check><a href=/39/streams/tutorial/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamstutorial><span>Write a streams app</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamscore-concepts-li><input type=checkbox id=m-39streamscore-concepts-check>
<label for=m-39streamscore-concepts-check><a href=/39/streams/core-concepts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamscore-concepts><span>Core Concepts</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsarchitecture-li><input type=checkbox id=m-39streamsarchitecture-check>
<label for=m-39streamsarchitecture-check><a href=/39/streams/architecture/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsarchitecture><span>Architecture</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsupgrade-guide-li><input type=checkbox id=m-39streamsupgrade-guide-check>
<label for=m-39streamsupgrade-guide-check><a href=/39/streams/upgrade-guide/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsupgrade-guide><span>Upgrade Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-39streamsdeveloper-guide-li><input type=checkbox id=m-39streamsdeveloper-guide-check>
<label for=m-39streamsdeveloper-guide-check><a href=/39/streams/developer-guide/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-39streamsdeveloper-guide><span>Streams Developer Guide</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsdeveloper-guidewrite-streams-app-li><input type=checkbox id=m-39streamsdeveloper-guidewrite-streams-app-check>
<label for=m-39streamsdeveloper-guidewrite-streams-app-check><a href=/39/streams/developer-guide/write-streams-app/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsdeveloper-guidewrite-streams-app><span>Writing a Streams Application</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsdeveloper-guideconfig-streams-li><input type=checkbox id=m-39streamsdeveloper-guideconfig-streams-check>
<label for=m-39streamsdeveloper-guideconfig-streams-check><a href=/39/streams/developer-guide/config-streams/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsdeveloper-guideconfig-streams><span>Configuring a Streams Application</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsdeveloper-guidedsl-api-li><input type=checkbox id=m-39streamsdeveloper-guidedsl-api-check>
<label for=m-39streamsdeveloper-guidedsl-api-check><a href=/39/streams/developer-guide/dsl-api/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsdeveloper-guidedsl-api><span>Streams DSL</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsdeveloper-guideprocessor-api-li><input type=checkbox id=m-39streamsdeveloper-guideprocessor-api-check>
<label for=m-39streamsdeveloper-guideprocessor-api-check><a href=/39/streams/developer-guide/processor-api/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsdeveloper-guideprocessor-api><span>Processor API</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsdeveloper-guidedsl-topology-naming-li><input type=checkbox id=m-39streamsdeveloper-guidedsl-topology-naming-check>
<label for=m-39streamsdeveloper-guidedsl-topology-naming-check><a href=/39/streams/developer-guide/dsl-topology-naming/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsdeveloper-guidedsl-topology-naming><span>Naming Operators in a Streams DSL application</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsdeveloper-guidedatatypes-li><input type=checkbox id=m-39streamsdeveloper-guidedatatypes-check>
<label for=m-39streamsdeveloper-guidedatatypes-check><a href=/39/streams/developer-guide/datatypes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsdeveloper-guidedatatypes><span>Data Types and Serialization</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsdeveloper-guidetesting-li><input type=checkbox id=m-39streamsdeveloper-guidetesting-check>
<label for=m-39streamsdeveloper-guidetesting-check><a href=/39/streams/developer-guide/testing/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsdeveloper-guidetesting><span>Testing a Streams Application</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsdeveloper-guideinteractive-queries-li><input type=checkbox id=m-39streamsdeveloper-guideinteractive-queries-check>
<label for=m-39streamsdeveloper-guideinteractive-queries-check><a href=/39/streams/developer-guide/interactive-queries/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsdeveloper-guideinteractive-queries><span>Interactive Queries</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsdeveloper-guidememory-mgmt-li><input type=checkbox id=m-39streamsdeveloper-guidememory-mgmt-check>
<label for=m-39streamsdeveloper-guidememory-mgmt-check><a href=/39/streams/developer-guide/memory-mgmt/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsdeveloper-guidememory-mgmt><span>Memory Management</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsdeveloper-guiderunning-app-li><input type=checkbox id=m-39streamsdeveloper-guiderunning-app-check>
<label for=m-39streamsdeveloper-guiderunning-app-check><a href=/39/streams/developer-guide/running-app/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsdeveloper-guiderunning-app><span>Running Streams Applications</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsdeveloper-guidemanage-topics-li><input type=checkbox id=m-39streamsdeveloper-guidemanage-topics-check>
<label for=m-39streamsdeveloper-guidemanage-topics-check><a href=/39/streams/developer-guide/manage-topics/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsdeveloper-guidemanage-topics><span>Managing Streams Application Topics</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsdeveloper-guidesecurity-li><input type=checkbox id=m-39streamsdeveloper-guidesecurity-check>
<label for=m-39streamsdeveloper-guidesecurity-check><a href=/39/streams/developer-guide/security/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsdeveloper-guidesecurity><span>Streams Security</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-39streamsdeveloper-guideapp-reset-tool-li><input type=checkbox id=m-39streamsdeveloper-guideapp-reset-tool-check>
<label for=m-39streamsdeveloper-guideapp-reset-tool-check><a href=/39/streams/developer-guide/app-reset-tool/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-39streamsdeveloper-guideapp-reset-tool><span>Application Reset Tool</span></a></label></li></ul></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/hvishwanath/kafka-site-md/tree/main/content/en/39/operations/kraft.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/hvishwanath/kafka-site-md/edit/main/content/en/39/operations/kraft.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/hvishwanath/kafka-site-md/new/main/content/en/39/operations?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/hvishwanath/kafka-site-md/issues/new?title=KRaft" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a id=print href=/39/operations/_print/><i class="fa-solid fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#configuration>Configuration</a><ul><li><a href=#process-roles>Process Roles</a></li><li><a href=#controllers>Controllers</a></li></ul></li><li><a href=#provisioning-nodes>Provisioning Nodes</a><ul><li><a href=#bootstrap-a-standalone-controller>Bootstrap a Standalone Controller</a></li><li><a href=#bootstrap-with-multiple-controllers>Bootstrap with Multiple Controllers</a></li><li><a href=#formatting-brokers-and-new-controllers>Formatting Brokers and New Controllers</a></li></ul></li><li><a href=#controller-membership-changes>Controller membership changes</a><ul><li><a href=#static-versus-dynamic-kraft-quorums>Static versus Dynamic KRaft Quorums</a></li><li><a href=#add-new-controller>Add New Controller</a></li><li><a href=#remove-controller>Remove Controller</a></li></ul></li><li><a href=#debugging>Debugging</a><ul><li><a href=#metadata-quorum-tool>Metadata Quorum Tool</a></li><li><a href=#dump-log-tool>Dump Log Tool</a></li><li><a href=#metadata-shell>Metadata Shell</a></li></ul></li><li><a href=#deploying-considerations>Deploying Considerations</a></li><li><a href=#missing-features>Missing Features</a></li><li><a href=#zookeeper-to-kraft-migration>ZooKeeper to KRaft Migration</a><ul><li><a href=#terminology>Terminology</a></li><li><a href=#migration-phases>Migration Phases</a></li><li><a href=#limitations>Limitations</a></li><li><a href=#preparing-for-migration>Preparing for migration</a></li><li><a href=#provisioning-the-kraft-controller-quorum>Provisioning the KRaft controller quorum</a></li><li><a href=#enter-migration-mode-on-the-brokers>Enter Migration Mode on the Brokers</a></li><li><a href=#migrating-brokers-to-kraft>Migrating brokers to KRaft</a></li><li><a href=#finalizing-the-migration>Finalizing the migration</a></li><li><a href=#reverting-to-zookeeper-mode-during-the-migration>Reverting to ZooKeeper mode During the Migration</a></li></ul></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tag Cloud</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://example.kafka-site-md.dev/tags/apis/ data-taxonomy-term=apis><span class=taxonomy-label>Apis</span><span class=taxonomy-count>31</span></a></li><li><a class=taxonomy-term href=https://example.kafka-site-md.dev/tags/configuration/ data-taxonomy-term=configuration><span class=taxonomy-label>Configuration</span><span class=taxonomy-count>31</span></a></li><li><a class=taxonomy-term href=https://example.kafka-site-md.dev/tags/design/ data-taxonomy-term=design><span class=taxonomy-label>Design</span><span class=taxonomy-count>31</span></a></li><li><a class=taxonomy-term href=https://example.kafka-site-md.dev/tags/developer-guide/ data-taxonomy-term=developer-guide><span class=taxonomy-label>Developer-Guide</span><span class=taxonomy-count>31</span></a></li><li><a class=taxonomy-term href=https://example.kafka-site-md.dev/tags/docs/ data-taxonomy-term=docs><span class=taxonomy-label>Docs</span><span class=taxonomy-count>1712</span></a></li><li><a class=taxonomy-term href=https://example.kafka-site-md.dev/tags/getting-started/ data-taxonomy-term=getting-started><span class=taxonomy-label>Getting-Started</span><span class=taxonomy-count>31</span></a></li><li><a class=taxonomy-term href=https://example.kafka-site-md.dev/tags/implementation/ data-taxonomy-term=implementation><span class=taxonomy-label>Implementation</span><span class=taxonomy-count>31</span></a></li><li><a class=taxonomy-term href=https://example.kafka-site-md.dev/tags/kafka/ data-taxonomy-term=kafka><span class=taxonomy-label>Kafka</span><span class=taxonomy-count>1712</span></a></li><li><a class=taxonomy-term href=https://example.kafka-site-md.dev/tags/ops/ data-taxonomy-term=ops><span class=taxonomy-label>Ops</span><span class=taxonomy-count>31</span></a></li><li><a class=taxonomy-term href=https://example.kafka-site-md.dev/tags/security/ data-taxonomy-term=security><span class=taxonomy-label>Security</span><span class=taxonomy-count>62</span></a></li><li><a class=taxonomy-term href=https://example.kafka-site-md.dev/tags/streams/ data-taxonomy-term=streams><span class=taxonomy-label>Streams</span><span class=taxonomy-count>62</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class="pageinfo pageinfo-warning"><p>You are viewing documentation for an older version (3.9) of Kafka.
For up-to-date documentation, see the
<a href=/40/ target=_blank>latest version</a>.</p></div><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/39/>AK 3.9.X</a></li><li class=breadcrumb-item><a href=/39/operations/>Operations</a></li><li class="breadcrumb-item active" aria-current=page>KRaft</li></ol></nav><div class=td-content><h1>KRaft</h1><div class=lead>KRaft</div><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://example.kafka-site-md.dev/tags/kafka/ data-taxonomy-term=kafka><span class=taxonomy-label>Kafka</span></a></li><li><a class=taxonomy-term href=https://example.kafka-site-md.dev/tags/docs/ data-taxonomy-term=docs><span class=taxonomy-label>Docs</span></a></li></ul></div></header><h1 id=kraft>KRaft<a class=td-heading-self-link href=#kraft aria-label="Heading self-link"></a></h1><h2 id=configuration>Configuration<a class=td-heading-self-link href=#configuration aria-label="Heading self-link"></a></h2><h3 id=process-roles>Process Roles<a class=td-heading-self-link href=#process-roles aria-label="Heading self-link"></a></h3><p>In KRaft mode each Kafka server can be configured as a controller, a broker, or both using the <code>process.roles</code> property. This property can have the following values:</p><ul><li>If <code>process.roles</code> is set to <code>broker</code>, the server acts as a broker.</li><li>If <code>process.roles</code> is set to <code>controller</code>, the server acts as a controller.</li><li>If <code>process.roles</code> is set to <code>broker,controller</code>, the server acts as both a broker and a controller.</li><li>If <code>process.roles</code> is not set at all, it is assumed to be in ZooKeeper mode.</li></ul><p>Kafka servers that act as both brokers and controllers are referred to as &ldquo;combined&rdquo; servers. Combined servers are simpler to operate for small use cases like a development environment. The key disadvantage is that the controller will be less isolated from the rest of the system. For example, it is not possible to roll or scale the controllers separately from the brokers in combined mode. Combined mode is not recommended in critical deployment environments.</p><h3 id=controllers>Controllers<a class=td-heading-self-link href=#controllers aria-label="Heading self-link"></a></h3><p>In KRaft mode, specific Kafka servers are selected to be controllers (unlike the ZooKeeper-based mode, where any server can become the Controller). The servers selected to be controllers will participate in the metadata quorum. Each controller is either an active or a hot standby for the current active controller.</p><p>A Kafka admin will typically select 3 or 5 servers for this role, depending on factors like cost and the number of concurrent failures your system should withstand without availability impact. A majority of the controllers must be alive in order to maintain availability. With 3 controllers, the cluster can tolerate 1 controller failure; with 5 controllers, the cluster can tolerate 2 controller failures.</p><p>All of the servers in a Kafka cluster discover the active controller using the <code>controller.quorum.bootstrap.servers</code> property. All the controllers should be enumerated in this property. Each controller is identified with their <code>host</code> and <code>port</code> information. For example:</p><pre><code>controller.quorum.bootstrap.servers=host1:port1,host2:port2,host3:port3
</code></pre><p>If a Kafka cluster has 3 controllers named controller1, controller2 and controller3, then controller1 may have the following configuration:</p><pre><code>process.roles=controller
node.id=1
listeners=CONTROLLER://controller1.example.com:9093
controller.quorum.bootstrap.servers=controller1.example.com:9093,controller2.example.com:9093,controller3.example.com:9093
controller.listener.names=CONTROLLER
</code></pre><p>Every broker and controller must set the <code>controller.quorum.bootstrap.servers</code> property.</p><h2 id=provisioning-nodes>Provisioning Nodes<a class=td-heading-self-link href=#provisioning-nodes aria-label="Heading self-link"></a></h2><p>The <code>kafka-storage.sh random-uuid</code> command can be used to generate a cluster ID for your new cluster. This cluster ID must be used when formatting each server in the cluster with the <code>kafka-storage.sh format</code> command.</p><p>This is different from how Kafka has operated in the past. Previously, Kafka would format blank storage directories automatically, and also generate a new cluster ID automatically. One reason for the change is that auto-formatting can sometimes obscure an error condition. This is particularly important for the metadata log maintained by the controller and broker servers. If a majority of the controllers were able to start with an empty log directory, a leader might be able to be elected with missing committed data.</p><h3 id=bootstrap-a-standalone-controller>Bootstrap a Standalone Controller<a class=td-heading-self-link href=#bootstrap-a-standalone-controller aria-label="Heading self-link"></a></h3><p>The recommended method for creating a new KRaft controller cluster is to bootstrap it with one voter and dynamically add the rest of the controllers. Bootstrapping the first controller can be done with the following CLI command:</p><pre><code>$ bin/kafka-storage.sh format --cluster-id &lt;cluster-id&gt; --standalone --config ./config/kraft/controller.properties
</code></pre><p>This command will 1) create a meta.properties file in metadata.log.dir with a randomly generated directory.id, 2) create a snapshot at 00000000000000000000-0000000000.checkpoint with the necessary control records (KRaftVersionRecord and VotersRecord) to make this Kafka node the only voter for the quorum.</p><h3 id=bootstrap-with-multiple-controllers>Bootstrap with Multiple Controllers<a class=td-heading-self-link href=#bootstrap-with-multiple-controllers aria-label="Heading self-link"></a></h3><p>The KRaft cluster metadata partition can also be bootstrapped with more than one voter. This can be done by using the &ndash;initial-controllers flag:</p><pre><code>cluster-id=$(bin/kafka-storage.sh random-uuid)
controller-0-uuid=$(bin/kafka-storage.sh random-uuid)
controller-1-uuid=$(bin/kafka-storage.sh random-uuid)
controller-2-uuid=$(bin/kafka-storage.sh random-uuid)

# In each controller execute
bin/kafka-storage.sh format --cluster-id ${cluster-id} \
                     --initial-controllers &quot;0@controller-0:1234:${controller-0-uuid},1@controller-1:1234:${controller-1-uuid},2@controller-2:1234:${controller-2-uuid}&quot; \
                     --config config/kraft/controller.properties
</code></pre><p>This command is similar to the standalone version but the snapshot at 00000000000000000000-0000000000.checkpoint will instead contain a VotersRecord that includes information for all of the controllers specified in &ndash;initial-controllers. It is important that the value of this flag is the same in all of the controllers with the same cluster id. In the replica description 0@controller-0:1234:3Db5QLSqSZieL3rJBUUegA, 0 is the replica id, 3Db5QLSqSZieL3rJBUUegA is the replica directory id, controller-0 is the replica&rsquo;s host and 1234 is the replica&rsquo;s port.</p><h3 id=formatting-brokers-and-new-controllers>Formatting Brokers and New Controllers<a class=td-heading-self-link href=#formatting-brokers-and-new-controllers aria-label="Heading self-link"></a></h3><p>When provisioning new broker and controller nodes that we want to add to an existing Kafka cluster, use the <code>kafka-storage.sh format</code> command with the &ndash;no-initial-controllers flag.</p><pre><code>$ bin/kafka-storage.sh format --cluster-id &lt;cluster-id&gt; --config config/kraft/server.properties --no-initial-controllers
</code></pre><h2 id=controller-membership-changes>Controller membership changes<a class=td-heading-self-link href=#controller-membership-changes aria-label="Heading self-link"></a></h2><h3 id=static-versus-dynamic-kraft-quorums>Static versus Dynamic KRaft Quorums<a class=td-heading-self-link href=#static-versus-dynamic-kraft-quorums aria-label="Heading self-link"></a></h3><p>There are two ways to run KRaft: the old way using static controller quorums, and the new way using KIP-853 dynamic controller quorums.</p><p>When using a static quorum, the configuration file for each broker and controller must specify the IDs, hostnames, and ports of all controllers in <code>controller.quorum.voters</code>.</p><p>In contrast, when using a dynamic quorum, you should set <code>controller.quorum.bootstrap.servers</code> instead. This configuration key need not contain all the controllers, but it should contain as many as possible so that all the servers can locate the quorum. In other words, its function is much like the <code>bootstrap.servers</code> configuration used by Kafka clients.</p><p>If you are not sure whether you are using static or dynamic quorums, you can determine this by running something like the following:</p><pre><code>  $ bin/kafka-features.sh --bootstrap-controller localhost:9093 describe
</code></pre><p>If the <code>kraft.version</code> field is level 0 or absent, you are using a static quorum. If it is 1 or above, you are using a dynamic quorum. For example, here is an example of a static quorum:</p><pre><code>Feature: kraft.version  SupportedMinVersion: 0  SupportedMaxVersion: 1  FinalizedVersionLevel: 0 Epoch: 5
Feature: metadata.version       SupportedMinVersion: 3.0-IV1    SupportedMaxVersion: 3.9-IV0 FinalizedVersionLevel: 3.9-IV0  Epoch: 5
</code></pre><p>Here is another example of a static quorum:</p><pre><code>Feature: metadata.version       SupportedMinVersion: 3.0-IV1    SupportedMaxVersion: 3.8-IV0 FinalizedVersionLevel: 3.8-IV0  Epoch: 5
</code></pre><p>Here is an example of a dynamic quorum:</p><pre><code>Feature: kraft.version  SupportedMinVersion: 0  SupportedMaxVersion: 1  FinalizedVersionLevel: 1 Epoch: 5
Feature: metadata.version       SupportedMinVersion: 3.0-IV1    SupportedMaxVersion: 3.9-IV0 FinalizedVersionLevel: 3.9-IV0  Epoch: 5
</code></pre><p>The static versus dynamic nature of the quorum is determined at the time of formatting. Specifically, the quorum will be formatted as dynamic if <code>controller.quorum.voters</code> is <strong>not</strong> present, and if the software version is Apache Kafka 3.9 or newer. If you have followed the instructions earlier in this document, you will get a dynamic quorum.</p><p>If you would like the formatting process to fail if a dynamic quorum cannot be achieved, format your controllers using the <code>--feature kraft.version=1</code>. (Note that you should not supply this flag when formatting brokers &ndash; only when formatting controllers.)</p><pre><code>  $ bin/kafka-storage.sh format -t KAFKA_CLUSTER_ID --feature kraft.version=1 -c config/kraft/controller.properties
  Cannot set kraft.version to 1 unless KIP-853 configuration is present. Try removing the --feature flag for kraft.version.
</code></pre><p>Note: Currently it is <strong>not</strong> possible to convert clusters using a static controller quorum to use a dynamic controller quorum. This function will be supported in the future release.</p><h3 id=add-new-controller>Add New Controller<a class=td-heading-self-link href=#add-new-controller aria-label="Heading self-link"></a></h3><p>If a dynamic controller cluster already exists, it can be expanded by first provisioning a new controller using the kafka-storage.sh tool and starting the controller. After starting the controller, the replication to the new controller can be monitored using the <code>kafka-metadata-quorum describe --replication</code> command. Once the new controller has caught up to the active controller, it can be added to the cluster using the <code>kafka-metadata-quorum add-controller</code> command. When using broker endpoints use the &ndash;bootstrap-server flag:</p><pre><code>$ bin/kafka-metadata-quorum.sh --command-config config/kraft/controller.properties --bootstrap-server localhost:9092 add-controller
</code></pre><p>When using controller endpoints use the &ndash;bootstrap-controller flag:</p><pre><code>$ bin/kafka-metadata-quorum.sh --command-config config/kraft/controller.properties --bootstrap-controller localhost:9092 add-controller
</code></pre><h3 id=remove-controller>Remove Controller<a class=td-heading-self-link href=#remove-controller aria-label="Heading self-link"></a></h3><p>If the dynamic controller cluster already exists, it can be shrunk using the <code>bin/kafka-metadata-quorum.sh remove-controller</code> command. Until KIP-996: Pre-vote has been implemented and released, it is recommended to shutdown the controller that will be removed before running the remove-controller command. When using broker endpoints use the &ndash;bootstrap-server flag:</p><pre><code>$ bin/kafka-metadata-quorum --bootstrap-server localhost:9092 remove-controller --controller-id &lt;id&gt; --controller-directory-id &lt;directory-id&gt;
</code></pre><p>When using controller endpoints use the &ndash;bootstrap-controller flag:</p><pre><code>$ bin/kafka-metadata-quorum --bootstrap-controller localhost:9092 remove-controller --controller-id &lt;id&gt; --controller-directory-id &lt;directory-id&gt;
</code></pre><h2 id=debugging>Debugging<a class=td-heading-self-link href=#debugging aria-label="Heading self-link"></a></h2><h3 id=metadata-quorum-tool>Metadata Quorum Tool<a class=td-heading-self-link href=#metadata-quorum-tool aria-label="Heading self-link"></a></h3><p>The <code>kafka-metadata-quorum</code> tool can be used to describe the runtime state of the cluster metadata partition. For example, the following command displays a summary of the metadata quorum:</p><pre><code>$ bin/kafka-metadata-quorum.sh --bootstrap-server localhost:9092 describe --status
ClusterId:              fMCL8kv1SWm87L_Md-I2hg
LeaderId:               3002
LeaderEpoch:            2
HighWatermark:          10
MaxFollowerLag:         0
MaxFollowerLagTimeMs:   -1
CurrentVoters:          [{&quot;id&quot;: 3000, &quot;directoryId&quot;: &quot;ILZ5MPTeRWakmJu99uBJCA&quot;, &quot;endpoints&quot;: [&quot;CONTROLLER://localhost:9093&quot;]},
                         {&quot;id&quot;: 3001, &quot;directoryId&quot;: &quot;b-DwmhtOheTqZzPoh52kfA&quot;, &quot;endpoints&quot;: [&quot;CONTROLLER://localhost:9094&quot;]},
                         {&quot;id&quot;: 3002, &quot;directoryId&quot;: &quot;g42deArWBTRM5A1yuVpMCg&quot;, &quot;endpoints&quot;: [&quot;CONTROLLER://localhost:9095&quot;]}]
CurrentObservers:       [{&quot;id&quot;: 0, &quot;directoryId&quot;: &quot;3Db5QLSqSZieL3rJBUUegA&quot;},
                         {&quot;id&quot;: 1, &quot;directoryId&quot;: &quot;UegA3Db5QLSqSZieL3rJBU&quot;},
                         {&quot;id&quot;: 2, &quot;directoryId&quot;: &quot;L3rJBUUegA3Db5QLSqSZie&quot;}]
</code></pre><h3 id=dump-log-tool>Dump Log Tool<a class=td-heading-self-link href=#dump-log-tool aria-label="Heading self-link"></a></h3><p>The <code>kafka-dump-log</code> tool can be used to debug the log segments and snapshots for the cluster metadata directory. The tool will scan the provided files and decode the metadata records. For example, this command decodes and prints the records in the first log segment:</p><pre><code>$ bin/kafka-dump-log.sh --cluster-metadata-decoder --files metadata_log_dir/__cluster_metadata-0/00000000000000000000.log
</code></pre><p>This command decodes and prints the records in the a cluster metadata snapshot:</p><pre><code>$ bin/kafka-dump-log.sh --cluster-metadata-decoder --files metadata_log_dir/__cluster_metadata-0/00000000000000000100-0000000001.checkpoint
</code></pre><h3 id=metadata-shell>Metadata Shell<a class=td-heading-self-link href=#metadata-shell aria-label="Heading self-link"></a></h3><p>The <code>kafka-metadata-shell</code> tool can be used to interactively inspect the state of the cluster metadata partition:</p><pre><code>$ bin/kafka-metadata-shell.sh --snapshot metadata_log_dir/__cluster_metadata-0/00000000000000000000.log
&gt;&gt; ls /
brokers  local  metadataQuorum  topicIds  topics
&gt;&gt; ls /topics
foo
&gt;&gt; cat /topics/foo/0/data
{
  &quot;partitionId&quot; : 0,
  &quot;topicId&quot; : &quot;5zoAlv-xEh9xRANKXt1Lbg&quot;,
  &quot;replicas&quot; : [ 1 ],
  &quot;isr&quot; : [ 1 ],
  &quot;removingReplicas&quot; : null,
  &quot;addingReplicas&quot; : null,
  &quot;leader&quot; : 1,
  &quot;leaderEpoch&quot; : 0,
  &quot;partitionEpoch&quot; : 0
}
&gt;&gt; exit
</code></pre><h2 id=deploying-considerations>Deploying Considerations<a class=td-heading-self-link href=#deploying-considerations aria-label="Heading self-link"></a></h2><ul><li>Kafka server&rsquo;s <code>process.role</code> should be set to either <code>broker</code> or <code>controller</code> but not both. Combined mode can be used in development environments, but it should be avoided in critical deployment environments.</li><li>For redundancy, a Kafka cluster should use 3 or more controllers, depending on factors like cost and the number of concurrent failures your system should withstand without availability impact. For the KRaft controller cluster to withstand <code>N</code> concurrent failures the controller cluster must include <code>2N + 1</code> controllers.</li><li>The Kafka controllers store all the metadata for the cluster in memory and on disk. We believe that for a typical Kafka cluster 5GB of main memory and 5GB of disk space on the metadata log director is sufficient.</li></ul><h2 id=missing-features>Missing Features<a class=td-heading-self-link href=#missing-features aria-label="Heading self-link"></a></h2><p>The following features are not fully implemented in KRaft mode:</p><ul><li>Supporting JBOD configurations with multiple storage directories. Note that an Early Access release is supported in 3.7 as per <a href=https://cwiki.apache.org/confluence/display/KAFKA/KIP-858%3A+Handle+JBOD+broker+disk+failure+in+KRaft>KIP-858</a>. Note that it is not yet recommended for use in production environments. Please refer to the <a href=https://cwiki.apache.org/confluence/display/KAFKA/Kafka+JBOD+in+KRaft+Early+Access+Release+Notes>release notes</a> to help us test it and provide feedback at <a href=https://issues.apache.org/jira/browse/KAFKA-16061>KAFKA-16061</a>.</li><li>Modifying certain dynamic configurations on the standalone KRaft controller</li></ul><h2 id=zookeeper-to-kraft-migration>ZooKeeper to KRaft Migration<a class=td-heading-self-link href=#zookeeper-to-kraft-migration aria-label="Heading self-link"></a></h2><h3 id=terminology>Terminology<a class=td-heading-self-link href=#terminology aria-label="Heading self-link"></a></h3><ul><li>Brokers that are in <strong>ZK mode</strong> store their metadata in Apache ZooKepeer. This is the old mode of handling metadata.</li><li>Brokers that are in <strong>KRaft mode</strong> store their metadata in a KRaft quorum. This is the new and improved mode of handling metadata.</li><li><strong>Migration</strong> is the process of moving cluster metadata from ZooKeeper into a KRaft quorum.</li></ul><h3 id=migration-phases>Migration Phases<a class=td-heading-self-link href=#migration-phases aria-label="Heading self-link"></a></h3><p>In general, the migration process passes through several phases.</p><ul><li>In the <strong>initial phase</strong> , all the brokers are in ZK mode, and there is a ZK-based controller.</li><li>During the <strong>initial metadata load</strong> , a KRaft quorum loads the metadata from ZooKeeper,</li><li>In <strong>hybrid phase</strong> , some brokers are in ZK mode, but there is a KRaft controller.</li><li>In <strong>dual-write phase</strong> , all brokers are KRaft, but the KRaft controller is continuing to write to ZK.</li><li>When the migration has been <strong>finalized</strong> , we no longer write metadata to ZooKeeper.</li></ul><h3 id=limitations>Limitations<a class=td-heading-self-link href=#limitations aria-label="Heading self-link"></a></h3><ul><li>While a cluster is being migrated from ZK mode to KRaft mode, we do not support changing the <em>metadata version</em> (also known as the <em>inter.broker.protocol.version</em>.) Please do not attempt to do this during a migration, or you may break the cluster.</li><li>After the migration has been finalized, it is not possible to revert back to ZooKeeper mode.</li><li>During the migration, if a ZK broker is running with multiple log directories, any directory failure will cause the broker to shutdown. Brokers with broken log directories will only be able to migrate to KRaft once the directories are repaired. For further details refer to <a href=https://issues.apache.org/jira/browse/KAFKA-16431>KAFKA-16431</a>.</li><li>As noted above, some features are not fully implemented in KRaft mode. If you are using one of those features, you will not be able to migrate to KRaft yet.</li><li>There is a known inconsistency between ZK and KRaft modes in the arguments passed to an <code>AlterConfigPolicy</code>, when an <code>OpType.SUBTRACT</code> is processed. For further details refer to <a href=https://issues.apache.org/jira/browse/KAFKA-19026>KAFKA-19026</a>.</li></ul><h3 id=preparing-for-migration>Preparing for migration<a class=td-heading-self-link href=#preparing-for-migration aria-label="Heading self-link"></a></h3><p>Before beginning the migration, the Kafka brokers must be upgraded to software version 3.9.1 and have the &ldquo;inter.broker.protocol.version&rdquo; configuration set to &ldquo;3.9&rdquo;.</p><p>It is recommended to enable TRACE level logging for the migration components while the migration is active. This can be done by adding the following log4j configuration to each KRaft controller&rsquo;s &ldquo;log4j.properties&rdquo; file.</p><pre><code>log4j.logger.org.apache.kafka.metadata.migration=TRACE
</code></pre><p>It is generally useful to enable DEBUG logging on the KRaft controllers and the ZK brokers during the migration.</p><h3 id=provisioning-the-kraft-controller-quorum>Provisioning the KRaft controller quorum<a class=td-heading-self-link href=#provisioning-the-kraft-controller-quorum aria-label="Heading self-link"></a></h3><p>Two things are needed before the migration can begin. First, the brokers must be configured to support the migration and second, a KRaft controller quorum must be deployed. The KRaft controllers should be provisioned with the same cluster ID as the existing Kafka cluster. This can be found by examining one of the &ldquo;meta.properties&rdquo; files in the data directories of the brokers, or by running the following command.</p><pre><code>$ bin/zookeeper-shell.sh localhost:2181 get /cluster/id
</code></pre><p>The KRaft controller quorum should also be provisioned with the latest <code>metadata.version</code>. This is done automatically when you format the node with the <code>kafka-storage.sh</code> tool. For further instructions on KRaft deployment, please refer to the above documentation.</p><p>In addition to the standard KRaft configuration, the KRaft controllers will need to enable support for the migration as well as provide ZooKeeper connection configuration.</p><p>Here is a sample config for a KRaft controller that is ready for migration:</p><pre><code># Sample KRaft cluster controller.properties listening on 9093
process.roles=controller
node.id=3000
controller.quorum.bootstrap.servers=localhost:9093
controller.listener.names=CONTROLLER
listeners=CONTROLLER://:9093

# Enable the migration
zookeeper.metadata.migration.enable=true

# ZooKeeper client configuration
zookeeper.connect=localhost:2181

# The inter broker listener in brokers to allow KRaft controller send RPCs to brokers
inter.broker.listener.name=PLAINTEXT

# Other configs ...
</code></pre><p>Follow these steps to format and start a new standalone controller:</p><pre><code># Save the previously retrieved cluster ID from ZooKeeper in a variable called zk-cluster-id
$ bin/kafka-storage.sh format --standalone -t &lt;zk-cluster-id&gt; -c config/kraft/controller.properties
$ bin/kafka-server-start.sh config/kraft/controller.properties
</code></pre><p><em>Note: The KRaft cluster<code>node.id</code> values must be different from any existing ZK broker <code>broker.id</code>. In KRaft-mode, the brokers and controllers share the same Node ID namespace.</em></p><h3 id=enter-migration-mode-on-the-brokers>Enter Migration Mode on the Brokers<a class=td-heading-self-link href=#enter-migration-mode-on-the-brokers aria-label="Heading self-link"></a></h3><p>Once the KRaft controller quorum has been started, the brokers will need to be reconfigured and restarted. Brokers may be restarted in a rolling fashion to avoid impacting cluster availability. Each broker requires the following configuration to communicate with the KRaft controllers and to enable the migration.</p><ul><li>broker.id: Ensure <code>broker.id</code> is set to a non-negative integer even if <code>broker.id.generation.enable</code> is enabled (default is enabled). Additionally, ensure <code>broker.id</code> does not exceed <code>reserved.broker.max.id</code> to avoid failure.</li><li>controller.quorum.bootstrap.servers</li><li>controller.listener.names</li><li>The controller.listener.name should also be added to listener.security.property.map</li><li>zookeeper.metadata.migration.enable</li></ul><p>Here is a sample config for a broker that is ready for migration:</p><pre><code># Sample ZK broker server.properties listening on 9092
broker.id=0
listeners=PLAINTEXT://:9092
advertised.listeners=PLAINTEXT://localhost:9092
listener.security.protocol.map=PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT

# Set the IBP
inter.broker.protocol.version=3.9

# Enable the migration
zookeeper.metadata.migration.enable=true

# ZooKeeper client configuration
zookeeper.connect=localhost:2181

# KRaft controller quorum configuration
controller.quorum.bootstrap.servers=localhost:9093
controller.listener.names=CONTROLLER
</code></pre><p><em>Note: Once the final ZK broker has been restarted with the necessary configuration, the migration will automatically begin.</em> When the migration is complete, an INFO level log can be observed on the active controller:</p><pre><code>Completed migration of metadata from Zookeeper to KRaft
</code></pre><h3 id=migrating-brokers-to-kraft>Migrating brokers to KRaft<a class=td-heading-self-link href=#migrating-brokers-to-kraft aria-label="Heading self-link"></a></h3><p>Once the KRaft controller completes the metadata migration, the brokers will still be running in ZooKeeper mode. While the KRaft controller is in migration mode, it will continue sending controller RPCs to the ZooKeeper mode brokers. This includes RPCs like UpdateMetadata and LeaderAndIsr.</p><p>To migrate the brokers to KRaft, they simply need to be reconfigured as KRaft brokers and restarted. Using the above broker configuration as an example, we would replace the <code>broker.id</code> with <code>node.id</code> and add <code>process.roles=broker</code>. It is important that the broker maintain the same Broker/Node ID when it is restarted. The zookeeper configurations should be removed at this point. Finally, if you have set <code>control.plane.listener.name</code>. please remove it before restarting in KRaft mode.</p><p>If your broker has authorization configured via the <code>authorizer.class.name</code> property using <code>kafka.security.authorizer.AclAuthorizer</code>, this is also the time to change it to use <code>org.apache.kafka.metadata.authorizer.StandardAuthorizer</code> instead.</p><pre><code># Sample KRaft broker server.properties listening on 9092
process.roles=broker
node.id=0
listeners=PLAINTEXT://:9092
advertised.listeners=PLAINTEXT://localhost:9092
listener.security.protocol.map=PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT

# Don't set the IBP, KRaft uses &quot;metadata.version&quot; feature flag
# inter.broker.protocol.version=3.9

# Remove the migration enabled flag
# zookeeper.metadata.migration.enable=true

# Remove ZooKeeper client configuration
# zookeeper.connect=localhost:2181

# Keep the KRaft controller quorum configuration
controller.quorum.bootstrap.servers=localhost:9093
controller.listener.names=CONTROLLER
</code></pre><p>Each broker is restarted with a KRaft configuration until the entire cluster is running in KRaft mode.</p><h3 id=finalizing-the-migration>Finalizing the migration<a class=td-heading-self-link href=#finalizing-the-migration aria-label="Heading self-link"></a></h3><p>Once all brokers have been restarted in KRaft mode, the last step to finalize the migration is to take the KRaft controllers out of migration mode. This is done by removing the &ldquo;zookeeper.metadata.migration.enable&rdquo; property from each of their configs and restarting them one at a time.</p><p>Once the migration has been finalized, you can safely deprovision your ZooKeeper cluster, assuming you are not using it for anything else. After this point, it is no longer possible to revert to ZooKeeper mode.</p><pre><code># Sample KRaft cluster controller.properties listening on 9093
process.roles=controller
node.id=3000
controller.quorum.bootstrap.servers=localhost:9093
controller.listener.names=CONTROLLER
listeners=CONTROLLER://:9093

# Disable the migration
# zookeeper.metadata.migration.enable=true

# Remove ZooKeeper client configuration
# zookeeper.connect=localhost:2181

# Other configs ...
</code></pre><h3 id=reverting-to-zookeeper-mode-during-the-migration>Reverting to ZooKeeper mode During the Migration<a class=td-heading-self-link href=#reverting-to-zookeeper-mode-during-the-migration aria-label="Heading self-link"></a></h3><p>While the cluster is still in migration mode, it is possible to revert to ZooKeeper mode. The process to follow depends on how far the migration has progressed. In order to find out how to revert, select the <strong>final</strong> migration step that you have <strong>completed</strong> in this table.</p><p>Note that the directions given here assume that each step was fully completed, and they were done in order. So, for example, we assume that if &ldquo;Enter Migration Mode on the Brokers&rdquo; was completed, &ldquo;Provisioning the KRaft controller quorum&rdquo; was also fully completed previously.</p><p>If you did not fully complete any step, back out whatever you have done and then follow revert directions for the last fully completed step.</p><table><thead><tr><th>Final Migration Section Completed</th><th>Directions for Reverting</th><th>Notes</th></tr></thead><tbody><tr><td>Preparing for migration</td><td>The preparation section does not involve leaving ZooKeeper mode. So there is nothing to do in the case of a revert.</td><td></td></tr><tr><td>Provisioning the KRaft controller quorum</td><td></td><td></td></tr></tbody></table><ul><li>Deprovision the KRaft controller quorum.</li><li>Then you are done.</li></ul><p>|<br>Enter Migration Mode on the brokers |</p><ul><li>Deprovision the KRaft controller quorum.</li><li>Using <code>zookeeper-shell.sh</code>, run <code>delete /controller</code> so that one of the brokers can become the new old-style controller. Additionally, run <code>get /migration</code> followed by <code>delete /migration</code> to clear the migration state from ZooKeeper. This will allow you to re-attempt the migration in the future. The data read from &ldquo;/migration&rdquo; can be useful for debugging.</li><li>On each broker, remove the <code>zookeeper.metadata.migration.enable</code>, <code>controller.listener.names</code>, and <code>controller.quorum.bootstrap.servers</code> configurations, and replace <code>node.id</code> with <code>broker.id</code>. Then perform a rolling restart of all brokers.</li><li>Then you are done.</li></ul><p>| It is important to perform the <code>zookeeper-shell.sh</code> step <strong>quickly</strong> , to minimize the amount of time that the cluster lacks a controller. Until the <code>/controller</code> znode is deleted, you can also ignore any errors in the broker log about failing to connect to the Kraft controller. Those error logs should disappear after second roll to pure zookeeper mode.<br>Migrating brokers to KRaft |</p><ul><li>On each broker, remove the <code>process.roles</code> configuration, replace the <code>node.id</code> with <code>broker.id</code> and restore the <code>zookeeper.connect</code> configuration to its previous value. If your cluster requires other ZooKeeper configurations for brokers, such as <code>zookeeper.ssl.protocol</code>, re-add those configurations as well. Then perform a rolling restart of all brokers.</li><li>Deprovision the KRaft controller quorum.</li><li>Using <code>zookeeper-shell.sh</code>, run <code>delete /controller</code> so that one of the brokers can become the new old-style controller. Additionally, run <code>get /migration</code> followed by <code>delete /migration</code> to clear the migration state from ZooKeeper. This will allow you to re-attempt the migration in the future. The data read from &ldquo;/migration&rdquo; can be useful for debugging.</li><li>On each broker, remove the <code>zookeeper.metadata.migration.enable</code>, <code>controller.listener.names</code>, and <code>controller.quorum.bootstrap.servers</code> configurations. Then perform a second rolling restart of all brokers.</li><li>Then you are done.</li></ul><p>|</p><ul><li>It is important to perform the <code>zookeeper-shell.sh</code> step <strong>quickly</strong> , to minimize the amount of time that the cluster lacks a controller. Until the <code>/controller</code> znode is deleted, you can also ignore any errors in the broker log about failing to connect to the Kraft controller. Those error logs should disappear after second roll to pure zookeeper mode.</li><li>Make sure that on the first cluster roll, <code>zookeeper.metadata.migration.enable</code> remains set to <code>true</code>. <strong>Do not set it to false until the second cluster roll.</strong></li></ul><p>Finalizing the migration | If you have finalized the ZK migration, then you cannot revert. | Some users prefer to wait for a week or two before finalizing the migration. While this requires you to keep the ZooKeeper cluster running for a while longer, it may be helpful in validating KRaft mode in your cluster.</p><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/USERNAME/REPOSITORY/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/USERNAME/REPOSITORY/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof gtag!="function")return;gtag("event","page_helpful",{event_category:"Helpful",event_label:window.location.pathname,value:e})};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(100)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br><div class=td-page-meta__lastmod>Last modified July 6, 2025: <a href=https://github.com/hvishwanath/kafka-site-md/commit/504bfc846d595eb949277588661a95f76b9860cd>Multiple fixes. Handling CVE list and links correctly. ZK to KRaft migration heading levels fixes (504bfc84)</a></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Contact aria-label=Contact><a target=_blank rel=noopener href=/community/contact/ aria-label=Contact><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Twitter aria-label=Twitter><a target=_blank rel=noopener href=https://twitter.com/apachekafka aria-label=Twitter><i class="fab fa-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Stack Overflow" aria-label="Stack Overflow"><a target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/apache-kafka aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/apache/kafka aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Developer mailing list" aria-label="Developer mailing list"><a target=_blank rel=noopener href=mailto:dev@kafka.apache.org aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2014&ndash;2025
<span class=td-footer__authors>By <a href=https://www.apache.org/>Apache Software Foundation</a> under the terms of the <a href=https://www.apache.org/licenses/LICENSE-2.0>Apache License v2</a></span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=https://privacy.apache.org/policies/privacy-policy-public.html target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.dc2c0119076a0df855e55a8044ce0de74b7b9033c20e853e22d7ec7e9bdde965.js integrity="sha256-3CwBGQdqDfhV5VqARM4N50t7kDPCDoU+Itfsfpvd6WU=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>